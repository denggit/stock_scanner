# 股票筛选系统 - 快速参考手册

## 🚀 快速启动

### 启动服务

```bash
# 启动后端
python run_backend.py

# 启动前端
python run_frontend.py
```

### 访问地址

- 前端界面: http://localhost:8501
- 后端API: http://localhost:8000
- API文档: http://localhost:8000/docs

---

## 📊 常用数据操作

### 获取股票数据

```python
from backend.data_source.baostock_source import BaostockSource

source = BaostockSource()
data = source.get_stock_data("000001.SZ", "2024-01-01", "2024-12-31")
```

### 使用缓存

```python
from backend.utils.cache_manager import stock_data_cache

@stock_data_cache(expire=1800)
def get_stock_data(code, start_date, end_date):
    return source.get_stock_data(code, start_date, end_date)
```

---

## 🎯 策略使用

### 爆发式选股策略

```python
from backend.strategies.explosive_stock import ExplosiveStockStrategy

strategy = ExplosiveStockStrategy()
strategy.set_parameters({
    "signal": 70.0,
    "volume_ratio": 1.5,
    "rsi_range": (45, 65)
})

signal = strategy.generate_signal(stock_data)
```

### 均线回踩策略

```python
from backend.strategies.ma_pullback import MAPullbackStrategy

strategy = MAPullbackStrategy()
strategy.set_parameters({
    "ma_period": 20,
    "lookback_period": 20,
    "price_margin": 0.01
})
```

---

## 🔧 工具函数

### 技术指标计算

```python
from backend.utils.indicators import CalIndicators

# 移动平均线
ma20 = CalIndicators.ema(df, 20, 'close')

# RSI
rsi = CalIndicators.rsi(df, 14)

# MACD
macd, signal, hist = CalIndicators.macd(df)

# 布林带
mid, upper, lower = CalIndicators.bollinger_bands(df, 20, 2.0)
```

### 性能监控

```python
from backend.utils.performance_monitor import get_performance_monitor

monitor = get_performance_monitor()
monitor.start_monitoring()

# 查看状态
metrics = monitor.get_current_metrics()
health = monitor.get_current_health()
```

---

## ⚙️ 配置管理

### 获取配置

```python
from backend.configs.app_config import get_config

config = get_config()
db_config = config.database
redis_config = config.redis
strategy_config = config.strategy
```

### 环境变量

```bash
# 数据库
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=stock_scanner

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# 后端
BACKEND_URL=localhost
BACKEND_PORT=8000
```

---

## 📈 回测系统

### 运行回测

```python
from backend.services.backtest_service import BacktestService

backtest = BacktestService()
results = await backtest.run_backtest(
    strategy="爆发式选股策略",
    start_date="2024-01-01",
    end_date="2024-12-31",
    backtest_init_params={
        "stock_pool": "非ST股票",
        "initial_capital": 100000,
        "max_positions": 4
    },
    params={"signal": 70.0}
)
```

---

## 🌐 API接口

### 获取股票数据

```bash
GET /api/stock/{code}?period=daily&start_date=2024-01-01&end_date=2024-12-31
```

### 策略扫描

```bash
POST /api/strategy/scan
{
    "strategy": "爆发式选股策略",
    "params": {
        "signal": 70.0,
        "volume_ratio": 1.5
    }
}
```

### 运行回测

```bash
POST /api/backtest/run
{
    "strategy": "爆发式选股策略",
    "start_date": "2024-01-01",
    "end_date": "2024-12-31",
    "backtest_init_params": {...},
    "params": {...}
}
```

---

## 🔍 调试工具

### 日志查看

```python
from backend.utils.logger import setup_logger

logger = setup_logger("my_module")
logger.info("信息")
logger.error("错误")
```

### 缓存管理

```python
from backend.utils.cache_manager import get_cache_manager

cache = get_cache_manager()
cache.clear()  # 清理所有缓存
cache.cleanup_expired()  # 清理过期缓存
```

### 数据库检查

```python
from backend.data.database import DatabaseManager

db = DatabaseManager()
db.conn.ping()  # 检查连接
```

---

## 📝 常用命令

### 数据更新

```python
from backend.data.data_manager import DataUpdateManager

manager = DataUpdateManager()
manager.update_stock_list()  # 更新股票列表
manager.update_daily_data()  # 更新日线数据
```

### 模型训练

```python
from backend.ml.model_trainer import ExplosiveStockModelTrainer

trainer = ExplosiveStockModelTrainer()
trainer.train_models()  # 训练模型
trainer.save_models("backend/ml/models/")  # 保存模型
```

---

## 🆘 故障排除

### 常见问题

1. **数据源连接失败**: 检查网络和API密钥
2. **数据库连接错误**: 检查MySQL服务状态
3. **Redis连接失败**: 检查Redis服务状态
4. **策略执行缓慢**: 使用缓存和批量处理

### 日志位置

- 应用日志: `logs/app.log`
- 错误日志: 查看控制台输出

### 性能监控

```python
# 查看系统状态
monitor = get_performance_monitor()
health = monitor.get_current_health()
print(f"状态: {health.status}")
print(f"信息: {health.message}")
```

---

## 📚 文件结构

```
stock_scanner/
├── backend/           # 后端代码
│   ├── data_source/   # 数据源
│   ├── strategies/    # 策略
│   ├── services/      # 服务层
│   ├── utils/         # 工具类
│   └── configs/       # 配置
├── pages/            # 前端页面
├── docs/             # 文档
├── logs/             # 日志
├── results/          # 结果
└── requirements.txt  # 依赖
```

---

## 🎯 开发流程

1. **策略开发**: 继承 `BaseStrategy` 类
2. **参数配置**: 使用 `set_parameters` 方法
3. **信号生成**: 实现 `generate_signal` 方法
4. **回测验证**: 使用回测系统验证策略
5. **性能优化**: 使用缓存和监控工具

---

*快速参考手册 - 2025年2月4日* 