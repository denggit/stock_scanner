# 🚀 股票扫描器 - 快速参考手册

## 📋 目录

- [🚀 快速启动](#-快速启动)
- [📊 数据操作](#-数据操作)
- [🎯 策略使用](#-策略使用)
- [🔧 工具函数](#-工具函数)
- [📈 回测框架](#-回测框架)
- [🧠 机器学习](#-机器学习)
- [🔍 因子分析](#-因子分析)
- [🌐 API接口](#-api接口)
- [📱 前端界面](#-前端界面)
- [🐛 故障排除](#-故障排除)

---

## 🚀 快速启动

### 环境准备

```bash
# 克隆项目
git clone <repository_url>
cd stock_scanner

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 启动服务

```bash
# 启动后端服务
python run_backend.py

# 启动前端界面
python run_frontend.py
```

### 访问地址

- **前端界面**: http://localhost:8501
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs
- **数据查看器**: http://localhost:8501/data_viewer

---

## 📊 数据操作

### 获取股票数据

```python
from backend.business.data.data_fetcher import StockDataFetcher

# 创建数据获取器
fetcher = StockDataFetcher()

# 获取股票数据
data = fetcher.fetch_stock_data(
    code="000001.SZ",
    start_date="2024-01-01",
    end_date="2024-12-31",
    period="daily"
)
```

### 多数据源支持

```python
# AKShare数据源
from backend.business.data.source.akshare_src import AKShareSource
akshare_source = AKShareSource()

# 宝硕数据源
from backend.business.data.source.baostock_src import BaostockSource
baostock_source = BaostockSource()
```

### 数据缓存

```python
from backend.utils.cache_manager import stock_data_cache

@stock_data_cache(expire=1800)  # 30分钟缓存
def get_stock_data(code, start_date, end_date):
    return fetcher.fetch_stock_data(code, start_date, end_date)
```

---

## 🎯 策略使用

### 策略基类

```python
from backend.business.strategies.base import BaseStrategy

class MyStrategy(BaseStrategy):
    def __init__(self):
        super().__init__()
        self.name = "我的策略"
        self.description = "策略描述"
    
    def generate_signal(self, data):
        # 实现策略逻辑
        return signal
```

### 爆发式选股策略

```python
from backend.business.strategies.explosive_stock import ExplosiveStockStrategy

strategy = ExplosiveStockStrategy()
strategy.set_parameters({
    "signal": 70.0,           # 信号强度阈值
    "volume_ratio": 1.5,      # 成交量比率
    "rsi_range": (45, 65),    # RSI范围
    "explosion_probability": 0.5  # 爆发概率阈值
})

# 生成信号
signal = strategy.generate_signal(stock_data)
```

### 均线回踩策略

```python
from backend.business.strategies.ma_pullback import MAPullbackStrategy

strategy = MAPullbackStrategy()
strategy.set_parameters({
    "ma_period": 20,          # 均线周期
    "lookback_period": 20,    # 回看周期
    "price_margin": 0.01,     # 价格容差
    "volume_ratio": 1.2       # 成交量比率
})
```

### 上升通道策略

```python
from backend.business.strategies.rising_channel import RisingChannelStrategy

strategy = RisingChannelStrategy()
strategy.set_parameters({
    "k": 2.0,                 # 通道宽度倍数
    "L_max": 120,             # 最大窗口长度
    "gain_trigger": 0.30,     # 重锚涨幅触发
    "beta_delta": 0.15        # 斜率变化阈值
})
```

---

## 🔧 工具函数

### 技术指标计算

```python
from backend.utils.indicators import CalIndicators

# 移动平均线
ma20 = CalIndicators.sma(df, 20, 'close')
ema20 = CalIndicators.ema(df, 20, 'close')

# RSI指标
rsi = CalIndicators.rsi(df, 14)

# MACD指标
macd, signal, hist = CalIndicators.macd(df, 12, 26, 9)

# 布林带
mid, upper, lower = CalIndicators.bollinger_bands(df, 20, 2.0)

# KDJ指标
k, d, j = CalIndicators.kdj(df, 9, 3)

# DMI指标
pdi, mdi, adx = CalIndicators.dmi(df, 14)

# 上升通道分析
channel_info = CalIndicators.ascending_channel(df, **params)
```

### 数据格式化

```python
from backend.utils.format_info import stock_code_dot, stock_code_plain

# 格式化股票代码
code_with_dot = stock_code_dot("000001")  # 返回 "sz.000001"
code_plain = stock_code_plain("sz.000001")  # 返回 "000001"
```

### API响应处理

```python
from backend.utils.api_response import convert_to_python_types

# 转换数据类型为Python原生类型
result = convert_to_python_types(dataframe_or_dict)
```

---

## 📈 回测框架

### 简单回测

```python
from backend.business.backtest import run_backtest
from backend.business.backtest.strategies.ma_strategy import MAStrategy

# 运行回测
results = run_backtest(
    data=stock_data,
    strategy_class=MAStrategy,
    initial_cash=100000.0,
    commission=0.0003,
    strategy_params={"ma_period": 20},
    strategy_name="MA策略"
)
```

### 多策略回测

```python
from backend.business.backtest import run_multi_strategy_backtest

strategies = [
    {"name": "MA策略", "class": MAStrategy, "params": {"ma_period": 20}},
    {"name": "MACD策略", "class": MACDStrategy, "params": {}}
]

results = run_multi_strategy_backtest(
    data=stock_data,
    strategies=strategies,
    initial_cash=100000.0
)
```

### 自定义回测策略

```python
from backend.business.backtest.core.base_strategy import BaseStrategy

class MyBacktestStrategy(BaseStrategy):
    def __init__(self):
        super().__init__()
        self.name = "自定义策略"
    
    def next(self):
        # 实现策略逻辑
        if self.data.close[-1] > self.data.close[-2]:
            self.buy()
        elif self.data.close[-1] < self.data.close[-2]:
            self.sell()
```

---

## 🧠 机器学习

### 模型训练

```python
from backend.business.ml.model_trainer import ExplosiveStockModelTrainer

# 创建训练器
trainer = ExplosiveStockModelTrainer()

# 训练模型
model = trainer.train_model(
    stock_pool="sz50",
    start_date="2020-01-01",
    end_date="2024-12-31"
)
```

### 数据收集

```python
from backend.business.ml.data_collector import ExplosiveStockDataCollector

# 收集训练数据
collector = ExplosiveStockDataCollector()
data = collector.collect_data(
    stock_pool="sz50",
    start_date="2020-01-01",
    end_date="2024-12-31"
)
```

---

## 🔍 因子分析

### 上升通道因子

```python
from backend.business.factor.core.engine.library.channel_analysis import AscendingChannelRegression

# 创建分析器
analyzer = AscendingChannelRegression()

# 拟合通道
state = analyzer.fit_channel(df)

# 获取通道信息
channel_info = state.to_dict()
```

### 因子性能分析

```python
from backend.business.factor.backtest.performance_analyzer import analyze_single_factor

# 分析因子性能
results = analyze_single_factor(
    factor_data=factor_data,
    returns=returns,
    factor_name="上升通道因子"
)
```

---

## 🌐 API接口

### 股票数据接口

```python
import requests

# 获取股票数据
response = requests.get(
    "http://localhost:8000/api/stock/000001",
    params={
        "period": "daily",
        "start_date": "2024-01-01",
        "end_date": "2024-12-31"
    }
)
data = response.json()
```

### 策略扫描接口

```python
# 策略扫描
response = requests.post(
    "http://localhost:8000/api/strategy/scan",
    json={
        "strategy": "爆发式选股策略",
        "params": {
            "signal": 70.0,
            "volume_ratio": 1.5
        }
    }
)
results = response.json()
```

### 回测接口

```python
# 运行回测
response = requests.get(
    "http://localhost:8000/api/backtest/run",
    params={
        "strategy": "MA策略",
        "start_date": "2024-01-01",
        "end_date": "2024-12-31",
        "backtest_init_params": {
            "stock_pool": "非ST股票",
            "initial_capital": 100000
        }
    }
)
backtest_results = response.json()
```

---

## 📱 前端界面

### 数据查看器

访问 `http://localhost:8501/data_viewer` 使用数据查看器：

- **交互式K线图**: 支持拖动、缩放、悬停显示详细信息
- **技术指标**: 均线、MACD、RSI、布林带等
- **上升通道分析**: 实时通道状态和质量评估
- **数据搜索**: 按日期或价格范围筛选数据

### 策略扫描器

访问 `http://localhost:8501/strategy_scanner` 使用策略扫描器：

- **多策略选择**: 支持8种不同的交易策略
- **参数配置**: 可视化参数调整
- **结果展示**: 表格和图表展示扫描结果
- **数据导出**: 支持Excel格式导出

### 回测页面

访问 `http://localhost:8501/backtest` 使用回测功能：

- **策略回测**: 历史数据回测验证
- **参数优化**: 策略参数自动优化
- **结果分析**: 详细的回测报告和图表
- **性能对比**: 多策略性能对比分析

---

## 🐛 故障排除

### 常见问题

1. **后端服务启动失败**
   ```bash
   # 检查端口占用
   lsof -i :8000
   
   # 检查依赖安装
   pip install -r requirements.txt
   ```

2. **数据获取失败**
   ```python
   # 检查网络连接
   import requests
   requests.get("http://localhost:8000/test")
   
   # 检查数据源配置
   from backend.business.data.source.akshare_src import AKShareSource
   source = AKShareSource()
   ```

3. **策略执行错误**
   ```python
   # 检查数据格式
   print(data.columns)
   print(data.dtypes)
   
   # 检查策略参数
   strategy.validate_parameters(params)
   ```

### 日志查看

```bash
# 查看服务日志
tail -f logs/stock_service/stock_service_*.log
tail -f logs/strategy_service/strategy_service_*.log
tail -f logs/backtest_service/backtest_service_*.log
```

### 性能优化

```python
# 启用数据缓存
from backend.utils.cache_manager import enable_cache
enable_cache()

# 使用异步请求
import asyncio
from backend.services.stock_service import StockService

async def get_data():
    service = StockService()
    return await service.get_stock_data("000001", "daily")
```

---

## 📚 更多资源

- **API文档**: http://localhost:8000/docs
- **项目文档**: `docs/` 目录
- **使用示例**: `docs/模块使用示例/`
- **开发文档**: `docs/模块开发文档/`

---

**最后更新时间**: 2025年8月5日
**文档版本**: v2.0 