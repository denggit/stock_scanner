# ä¸Šå‡é€šé“å¿«æ·è°ƒç”¨ä½¿ç”¨ç¤ºä¾‹

## ğŸ“‹ æ¦‚è¿°

åœ¨ `backend/utils/indicators.py` ä¸­æ–°å¢äº†ä¸Šå‡é€šé“å›å½’åˆ†æçš„å¿«æ·è°ƒç”¨æ–¹æ³•ï¼Œè®©æ‚¨å¯ä»¥åƒä½¿ç”¨å…¶ä»–æŠ€æœ¯æŒ‡æ ‡ä¸€æ ·ç®€å•åœ°è°ƒç”¨ä¸Šå‡é€šé“åˆ†æåŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import pandas as pd
from backend.utils.indicators import CalIndicators

# å‡†å¤‡æ•°æ®ï¼ˆå¿…é¡»åŒ…å« trade_date, open, high, low, close, volume åˆ—ï¼‰
df = pd.DataFrame({
    'trade_date': [...],  # æ—¥æœŸåºåˆ—
    'open': [...],        # å¼€ç›˜ä»·
    'high': [...],        # æœ€é«˜ä»·
    'low': [...],         # æœ€ä½ä»·
    'close': [...],       # æ”¶ç›˜ä»·
    'volume': [...]       # æˆäº¤é‡
})

# è®¡ç®—ä¸Šå‡é€šé“å›å½’åˆ†æ
channel_info = CalIndicators.ascending_channel(df)
l
# æŸ¥çœ‹ç»“æœ
print(f"æ–œç‡: {channel_info['beta']:.4f}")
print(f"ä»Šæ—¥ä¸­è½´: {channel_info['mid_today']:.2f}")
print(f"ä»Šæ—¥ä¸Šæ²¿: {channel_info['upper_today']:.2f}")
print(f"ä»Šæ—¥ä¸‹æ²¿: {channel_info['lower_today']:.2f}")
print(f"é€šé“çŠ¶æ€: {channel_info['channel_status']}")
print(f"ç´¯è®¡æ¶¨å¹…: {channel_info['cumulative_gain']:.2%}")
```

### ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

```python
# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
custom_config_path = "path/to/custom_config.yaml"
channel_info = CalIndicators.ascending_channel(df, config_path=custom_config_path)
```

## ğŸ“Š è¿”å›ç»“æœè¯´æ˜

### é€šé“ä¿¡æ¯å­—å…¸

```python
{
    "beta": 0.0427,              # æœ€æ–°æ–œç‡ beta_t
    "mid_today": 34.89,          # ä»Šæ—¥ä¸­è½´ä»·
    "upper_today": 36.51,        # ä»Šæ—¥ä¸Šæ²¿ä»·
    "lower_today": 33.28,        # ä»Šæ—¥ä¸‹æ²¿ä»·
    "mid_tomorrow": 34.93,       # é¢„ä¼°ä¸‹ä¸€äº¤æ˜“æ—¥ä¸­è½´ä»·
    "upper_tomorrow": 36.55,     # é¢„ä¼°ä¸‹ä¸€äº¤æ˜“æ—¥ä¸Šæ²¿ä»·
    "lower_tomorrow": 33.31,     # é¢„ä¼°ä¸‹ä¸€äº¤æ˜“æ—¥ä¸‹æ²¿ä»·
    "channel_status": "NORMAL",  # é€šé“çŠ¶æ€
    "anchor_date": "2024-01-15T00:00:00",  # é”šç‚¹æ—¥æœŸ
    "anchor_price": 30.50,       # é”šç‚¹ä»·æ ¼
    "break_cnt_up": 0,           # è¿ç»­çªç ´ä¸Šæ²¿æ¬¡æ•°
    "break_cnt_down": 0,         # è¿ç»­çªç ´ä¸‹æ²¿æ¬¡æ•°
    "reanchor_fail_up": 0,       # é‡é”šå¤±è´¥æ¬¡æ•°ï¼ˆä¸Šæ²¿ï¼‰
    "reanchor_fail_down": 0,     # é‡é”šå¤±è´¥æ¬¡æ•°ï¼ˆä¸‹æ²¿ï¼‰
    "cumulative_gain": 0.1575,   # ç´¯è®¡æ¶¨å¹…
    "last_update": "2024-12-19T00:00:00"  # æœ€åæ›´æ–°æ—¶é—´
}
```

### é€šé“çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | æè¿° | å«ä¹‰ |
|------|------|------|
| `NORMAL` | é€šé“æ­£å¸¸ | ä»·æ ¼åœ¨é€šé“å†…æ­£å¸¸æ³¢åŠ¨ |
| `ACCEL_BREAKOUT` | åŠ é€Ÿçªç ´ | è¿ç»­çªç ´ä¸Šæ²¿ï¼Œå¯èƒ½è¿›å…¥åŠ é€Ÿä¸Šæ¶¨ |
| `BREAKDOWN` | è·Œç ´ä¸‹æ²¿ | è¿ç»­è·Œç ´ä¸‹æ²¿ï¼Œè¶‹åŠ¿å¯èƒ½åè½¬ |
| `BROKEN` | é€šé“å¤±æ•ˆ | é€šé“å·²å¤±æ•ˆï¼Œéœ€è¦é‡æ–°å»ºç«‹ |

## ğŸ”§ é«˜çº§åŠŸèƒ½

### æ‰¹é‡è®¡ç®—

```python
# å‡†å¤‡å¤šä¸ªæ•°æ®é›†
df_list = [df1, df2, df3, ...]  # å¤šä¸ªDataFrameçš„åˆ—è¡¨

# æ‰¹é‡è®¡ç®—ä¸Šå‡é€šé“
results = CalIndicators.ascending_channel_batch(df_list)

# å¤„ç†ç»“æœ
for i, result in enumerate(results):
    if result:
        print(f"æ•°æ®é›† {i+1}: æ–œç‡={result['beta']:.4f}, çŠ¶æ€={result['channel_status']}")
    else:
        print(f"æ•°æ®é›† {i+1}: è®¡ç®—å¤±è´¥")
```

### ä¸å…¶ä»–æŒ‡æ ‡ç»“åˆä½¿ç”¨

```python
# è®¡ç®—å¤šä¸ªæŒ‡æ ‡
macd, macd_signal, macd_hist = CalIndicators.macd(df)
rsi = CalIndicators.rsi(df)
channel_info = CalIndicators.ascending_channel(df)

# ç»¼åˆåˆ†æ
if (channel_info['channel_status'] == 'NORMAL' and 
    channel_info['beta'] > 0.02 and  # æ–œç‡å¤§äº2%
    rsi.iloc[-1] < 70 and           # RSIä¸è¿‡çƒ­
    macd.iloc[-1] > macd_signal.iloc[-1]):  # MACDé‡‘å‰
    
    print("ç¬¦åˆä¹°å…¥æ¡ä»¶")
```

## ğŸ“ˆ å®é™…åº”ç”¨åœºæ™¯

### 1. ç­–ç•¥æ‰«æ

```python
def scan_ascending_channels(stock_list):
    """æ‰«æä¸Šå‡é€šé“è‚¡ç¥¨"""
    results = []
    
    for stock_code in stock_list:
        try:
            # è·å–è‚¡ç¥¨æ•°æ®
            df = get_stock_data(stock_code, days=252)
            
            # è®¡ç®—ä¸Šå‡é€šé“
            channel_info = CalIndicators.ascending_channel(df)
            
            # ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨
            if (channel_info['channel_status'] == 'NORMAL' and 
                channel_info['beta'] > 0.02 and  # æ–œç‡å¤§äº2%
                channel_info['cumulative_gain'] > 0.1):  # ç´¯è®¡æ¶¨å¹…å¤§äº10%
                
                results.append({
                    'code': stock_code,
                    'beta': channel_info['beta'],
                    'gain': channel_info['cumulative_gain'],
                    'status': channel_info['channel_status'],
                    'upper': channel_info['upper_today'],
                    'lower': channel_info['lower_today']
                })
                
        except Exception as e:
            print(f"åˆ†æè‚¡ç¥¨ {stock_code} å¤±è´¥: {e}")
    
    return results
```

### 2. é£é™©ç›‘æ§

```python
def monitor_channel_risk(df):
    """ç›‘æ§é€šé“é£é™©"""
    channel_info = CalIndicators.ascending_channel(df)
    
    risk_level = "LOW"
    risk_reasons = []
    
    # æ£€æŸ¥å„ç§é£é™©ä¿¡å·
    if channel_info['channel_status'] == 'BREAKDOWN':
        risk_level = "HIGH"
        risk_reasons.append("è·Œç ´é€šé“ä¸‹æ²¿")
    
    if channel_info['break_cnt_down'] >= 2:
        risk_level = "MEDIUM"
        risk_reasons.append("è¿ç»­è·Œç ´ä¸‹æ²¿")
    
    if channel_info['cumulative_gain'] > 0.5:
        risk_level = "MEDIUM"
        risk_reasons.append("ç´¯è®¡æ¶¨å¹…è¿‡å¤§")
    
    return {
        'risk_level': risk_level,
        'reasons': risk_reasons,
        'channel_info': channel_info
    }
```

### 3. äº¤æ˜“ä¿¡å·ç”Ÿæˆ

```python
def generate_trading_signals(df):
    """ç”Ÿæˆäº¤æ˜“ä¿¡å·"""
    channel_info = CalIndicators.ascending_channel(df)
    current_price = df['close'].iloc[-1]
    
    signals = []
    
    # ä¹°å…¥ä¿¡å·
    if (channel_info['channel_status'] == 'ACCEL_BREAKOUT' and
        current_price > channel_info['upper_today']):
        signals.append({
            'type': 'BUY',
            'reason': 'åŠ é€Ÿçªç ´ä¸Šæ²¿',
            'price': current_price,
            'target': channel_info['upper_tomorrow']
        })
    
    # å–å‡ºä¿¡å·
    elif (channel_info['channel_status'] == 'BREAKDOWN' and
          current_price < channel_info['lower_today']):
        signals.append({
            'type': 'SELL',
            'reason': 'è·Œç ´ä¸‹æ²¿',
            'price': current_price,
            'stop_loss': channel_info['lower_tomorrow']
        })
    
    return signals
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®è¦æ±‚

1. **å¿…éœ€åˆ—**: æ•°æ®å¿…é¡»åŒ…å« `trade_date`, `open`, `high`, `low`, `close`, `volume` åˆ—
2. **æ•°æ®é•¿åº¦**: è‡³å°‘éœ€è¦60ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®
3. **æ•°æ®è´¨é‡**: ç¡®ä¿æ•°æ®æŒ‰æ—¶é—´æ’åºï¼Œæ— ç¼ºå¤±å€¼
4. **æ•°æ®æ ¼å¼**: æ—¥æœŸåˆ—åº”ä¸º `datetime` ç±»å‹ï¼Œä»·æ ¼åˆ—åº”ä¸ºæ•°å€¼ç±»å‹

### é”™è¯¯å¤„ç†

```python
try:
    channel_info = CalIndicators.ascending_channel(df)
    # å¤„ç†ç»“æœ
except ImportError as e:
    print("ä¸Šå‡é€šé“æ¨¡å—ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥å®‰è£…")
except ValueError as e:
    print(f"æ•°æ®æ ¼å¼é”™è¯¯: {e}")
except Exception as e:
    print(f"è®¡ç®—å¤±è´¥: {e}")
```

### æ€§èƒ½ä¼˜åŒ–

```python
# å¯¹äºå¤§é‡æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨æ‰¹é‡è®¡ç®—
df_list = [df1, df2, df3, ...]
results = CalIndicators.ascending_channel_batch(df_list)

# æˆ–è€…å¹¶è¡Œå¤„ç†
import concurrent.futures

def process_single_df(df):
    return CalIndicators.ascending_channel(df)

with concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:
    results = list(executor.map(process_single_df, df_list))
```

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥æ¨¡å—å¯ç”¨æ€§

```python
from backend.utils.indicators import ASCENDING_CHANNEL_AVAILABLE

if ASCENDING_CHANNEL_AVAILABLE:
    print("ä¸Šå‡é€šé“æ¨¡å—å¯ç”¨")
else:
    print("ä¸Šå‡é€šé“æ¨¡å—ä¸å¯ç”¨")
```

### éªŒè¯æ•°æ®æ ¼å¼

```python
def validate_data(df):
    """éªŒè¯æ•°æ®æ ¼å¼"""
    required_columns = ['trade_date', 'open', 'high', 'low', 'close', 'volume']
    
    # æ£€æŸ¥å¿…éœ€åˆ—
    missing_columns = [col for col in required_columns if col not in df.columns]
    if missing_columns:
        print(f"ç¼ºå°‘å¿…éœ€åˆ—: {missing_columns}")
        return False
    
    # æ£€æŸ¥æ•°æ®é•¿åº¦
    if len(df) < 60:
        print(f"æ•°æ®ä¸è¶³ï¼Œéœ€è¦è‡³å°‘60æ¡ï¼Œå½“å‰åªæœ‰{len(df)}æ¡")
        return False
    
    # æ£€æŸ¥æ•°æ®ç±»å‹
    if not pd.api.types.is_datetime64_any_dtype(df['trade_date']):
        print("æ—¥æœŸåˆ—æ ¼å¼ä¸æ­£ç¡®")
        return False
    
    return True
```

## ğŸ“ å®Œæ•´ç¤ºä¾‹

```python
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
from backend.utils.indicators import CalIndicators

# ç”Ÿæˆç¤ºä¾‹æ•°æ®
def generate_sample_data(n_days=100):
    dates = pd.date_range('2023-01-01', periods=n_days, freq='D')
    
    # ç”Ÿæˆä¸Šå‡è¶‹åŠ¿æ•°æ®
    base_trend = np.linspace(10, 50, n_days)
    noise = np.random.normal(0, 1, n_days)
    prices = base_trend + noise
    
    data = []
    for i, (date, price) in enumerate(zip(dates, prices)):
        data.append({
            'trade_date': date,
            'open': price * (1 + np.random.uniform(-0.02, 0.02)),
            'high': price * (1 + np.random.uniform(0.01, 0.05)),
            'low': price * (1 - np.random.uniform(0.01, 0.05)),
            'close': price,
            'volume': np.random.randint(1000000, 10000000)
        })
    
    return pd.DataFrame(data)

# ä¸»ç¨‹åº
def main():
    # ç”Ÿæˆæ•°æ®
    df = generate_sample_data(120)
    
    # è®¡ç®—ä¸Šå‡é€šé“
    channel_info = CalIndicators.ascending_channel(df)
    
    # è¾“å‡ºç»“æœ
    print("=== ä¸Šå‡é€šé“åˆ†æç»“æœ ===")
    print(f"æ–œç‡: {channel_info['beta']:.4f}")
    print(f"ä»Šæ—¥ä¸­è½´: {channel_info['mid_today']:.2f}")
    print(f"ä»Šæ—¥ä¸Šæ²¿: {channel_info['upper_today']:.2f}")
    print(f"ä»Šæ—¥ä¸‹æ²¿: {channel_info['lower_today']:.2f}")
    print(f"æ˜æ—¥é¢„æµ‹ä¸­è½´: {channel_info['mid_tomorrow']:.2f}")
    print(f"é€šé“çŠ¶æ€: {channel_info['channel_status']}")
    print(f"ç´¯è®¡æ¶¨å¹…: {channel_info['cumulative_gain']:.2%}")
    print(f"é”šç‚¹æ—¥æœŸ: {channel_info['anchor_date']}")
    print(f"é”šç‚¹ä»·æ ¼: {channel_info['anchor_price']:.2f}")

if __name__ == "__main__":
    main()
```

## ğŸŒ å‰ç«¯é¡µé¢é›†æˆ

### æ•°æ®æŸ¥çœ‹å™¨é›†æˆ

ä¸Šå‡é€šé“åŠŸèƒ½å·²æˆåŠŸé›†æˆåˆ° `pages/data_viewer.py` å‰ç«¯é¡µé¢ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ï¼š

#### 1. å¯ç”¨ä¸Šå‡é€šé“åŠŸèƒ½

åœ¨æ•°æ®æŸ¥çœ‹å™¨çš„ä¾§è¾¹æ ä¸­ï¼Œå‹¾é€‰"æ˜¾ç¤ºä¸Šå‡é€šé“"é€‰é¡¹å³å¯å¯ç”¨è¯¥åŠŸèƒ½ã€‚

#### 2. åŠŸèƒ½ç‰¹æ€§

- **å¯è§†åŒ–æ˜¾ç¤º**: åœ¨Kçº¿å›¾ä¸Šç»˜åˆ¶ä¸Šå‡é€šé“çš„ä¸­è½´çº¿ã€ä¸Šæ²¿çº¿ã€ä¸‹æ²¿çº¿å’Œé”šç‚¹
- **å®æ—¶è®¡ç®—**: è·å–æ•°æ®æ—¶è‡ªåŠ¨è®¡ç®—æœ€æ–°çš„ä¸Šå‡é€šé“ä¿¡æ¯
- **è¯¦ç»†ä¿¡æ¯**: æ˜¾ç¤ºæ–œç‡ã€é€šé“çŠ¶æ€ã€ä»Šæ—¥ä»·æ ¼ã€ç´¯è®¡æ¶¨å¹…ç­‰å…³é”®æŒ‡æ ‡
- **äº¤äº’ä½“éªŒ**: é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†çš„é€šé“ä¿¡æ¯

#### 3. å›¾è¡¨å…ƒç´ è¯´æ˜

| å…ƒç´  | é¢œè‰² | æ ·å¼ | è¯´æ˜ |
|------|------|------|------|
| ä¸­è½´çº¿ | æ©™è‰² | å®çº¿ | é€šé“çš„ä¸­å¿ƒè¶‹åŠ¿çº¿ |
| ä¸Šæ²¿çº¿ | çº¢è‰² | è™šçº¿ | é€šé“çš„ä¸Šè¾¹ç•Œ |
| ä¸‹æ²¿çº¿ | ç»¿è‰² | è™šçº¿ | é€šé“çš„ä¸‹è¾¹ç•Œ |
| é”šç‚¹ | æ©™è‰² | è±å½¢æ ‡è®° | é€šé“çš„èµ·å§‹ç‚¹ |

#### 4. ç»˜åˆ¶é€»è¾‘è¯´æ˜

**ä¸­è½´çº¿ç»˜åˆ¶ï¼š**
- åŸºäº `mid_today` å’Œ `mid_tomorrow` ä¸¤ç‚¹è®¡ç®—æ–œç‡
- ä» `mid_today` å¼€å§‹ï¼Œä½¿ç”¨è®¡ç®—å‡ºçš„æ–œç‡ç»˜åˆ¶ç›´çº¿
- å…¬å¼ï¼š`ä¸­è½´ä»·æ ¼ = mid_today + Î² Ã— ç›¸å¯¹å¤©æ•°`
- **é‡è¦**ï¼šä¸­è½´çº¿æ˜¯å›å½’çº¿æœ¬èº«ï¼Œä¸ä¸€å®šä¼šç©¿è¿‡é”šç‚¹

**ä¸Šæ²¿çº¿ç»˜åˆ¶ï¼š**
- ä¿æŒä¸ä¸­è½´çº¿ç›¸åŒçš„æ–œç‡
- ä» `upper_today` å¼€å§‹ç»˜åˆ¶
- å…¬å¼ï¼š`ä¸Šæ²¿ä»·æ ¼ = upper_today + Î² Ã— ç›¸å¯¹å¤©æ•°`

**ä¸‹æ²¿çº¿ç»˜åˆ¶ï¼š**
- ä¿æŒä¸ä¸­è½´çº¿ç›¸åŒçš„æ–œç‡
- ä» `lower_today` å¼€å§‹ç»˜åˆ¶
- å…¬å¼ï¼š`ä¸‹æ²¿ä»·æ ¼ = lower_today + Î² Ã— ç›¸å¯¹å¤©æ•°`

**ç›¸å¯¹å¤©æ•°è®¡ç®—ï¼š**
- ä»Šæ—¥å¯¹åº”çš„ç›¸å¯¹å¤©æ•°ä¸º0
- å†å²æ—¥æœŸä¸ºè´Ÿæ•°ï¼ˆ-1, -2, -3...ï¼‰
- æœªæ¥æ—¥æœŸä¸ºæ­£æ•°ï¼ˆ1, 2, 3...ï¼‰

**å›å½’çº¿è®¡ç®—ï¼š**
- ä½¿ç”¨ä»é”šç‚¹å¼€å§‹çš„æ‰€æœ‰æ•°æ®ç‚¹è¿›è¡Œçº¿æ€§å›å½’
- å›å½’çº¿å…¬å¼ï¼š`y = intercept + slope Ã— x`
- ä¸­è½´çº¿ä½¿ç”¨å›å½’çº¿çš„çœŸå®å‚æ•°ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶ä»é”šç‚¹å¼€å§‹
- é”šç‚¹æ˜¯æœ€ä½ä»·ï¼Œä¸­è½´çº¿é€šå¸¸é«˜äºé”šç‚¹

**é€šé“å®½åº¦ï¼š**
- æ•´ä¸ªé€šé“çš„å®½åº¦ä¿æŒä¸€è‡´
- ä¸Šæ²¿å’Œä¸‹æ²¿ä¸ä¸­è½´çš„è·ç¦»æ’å®š
- ç¡®ä¿é€šé“çš„å¹³è¡Œæ€§

#### 5. ä½¿ç”¨æ­¥éª¤

1. åœ¨ä¾§è¾¹æ è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001ï¼‰
2. é€‰æ‹©æ•°æ®å‘¨æœŸï¼ˆæ—¥çº¿/å‘¨çº¿/æœˆçº¿ï¼‰
3. è®¾ç½®æ—¥æœŸèŒƒå›´
4. å‹¾é€‰"æ˜¾ç¤ºä¸Šå‡é€šé“"é€‰é¡¹
5. ç‚¹å‡»"è·å–æ•°æ®"æŒ‰é’®
6. æŸ¥çœ‹Kçº¿å›¾ä¸Šçš„ä¸Šå‡é€šé“çº¿å’Œç›¸å…³ä¿¡æ¯é¢æ¿

#### 6. ä¿¡æ¯é¢æ¿

å¯ç”¨ä¸Šå‡é€šé“åï¼Œé¡µé¢ä¼šæ˜¾ç¤ºä¸€ä¸ªä¸“é—¨çš„"ğŸ“ˆ ä¸Šå‡é€šé“ä¿¡æ¯"é¢æ¿ï¼ŒåŒ…å«ï¼š

- **æ–œç‡**: é€šé“çš„ä¸Šå‡æ–œç‡
- **é€šé“çŠ¶æ€**: å½“å‰é€šé“çŠ¶æ€ï¼ˆNORMAL/ACCEL_BREAKOUT/BREAKDOWN/BROKENï¼‰
- **ä»Šæ—¥ä¸­è½´**: ä»Šæ—¥é€šé“ä¸­è½´ä»·æ ¼
- **ä»Šæ—¥ä¸Šæ²¿**: ä»Šæ—¥é€šé“ä¸Šæ²¿ä»·æ ¼
- **ä»Šæ—¥ä¸‹æ²¿**: ä»Šæ—¥é€šé“ä¸‹æ²¿ä»·æ ¼
- **ç´¯è®¡æ¶¨å¹…**: ä»é”šç‚¹å¼€å§‹çš„ç´¯è®¡æ¶¨å¹…
- **é”šç‚¹ä»·æ ¼**: é€šé“èµ·å§‹ä»·æ ¼
- **é”šç‚¹æ—¥æœŸ**: é€šé“èµ·å§‹æ—¥æœŸ

#### 7. è¯¦ç»†ä¿¡æ¯

ç‚¹å‡»"ğŸ“Š è¯¦ç»†é€šé“ä¿¡æ¯"å±•å¼€é¢æ¿å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„é€šé“ä¿¡æ¯JSONæ•°æ®ï¼ŒåŒ…æ‹¬ï¼š

- æ‰€æœ‰é€šé“å‚æ•°
- çªç ´è®¡æ•°å™¨
- é‡é”šå¤±è´¥æ¬¡æ•°
- é¢„æµ‹ä»·æ ¼ç­‰

#### 8. æ“ä½œè¯´æ˜

åœ¨å›¾è¡¨æ“ä½œè¯´æ˜ä¸­æ–°å¢äº†ä¸Šå‡é€šé“ç›¸å…³çš„è¯´æ˜ï¼š

- ä¸Šå‡é€šé“æ‚¬åœæ˜¾ç¤ºï¼šä¸­è½´ã€ä¸Šæ²¿ã€ä¸‹æ²¿ä»·æ ¼å’Œé€šé“çŠ¶æ€
- é€šé“çŠ¶æ€è¯´æ˜ï¼šå„ç§çŠ¶æ€çš„å«ä¹‰å’Œåˆ¤æ–­æ ‡å‡†
- å›¾è¡¨å…ƒç´ è¯´æ˜ï¼šå„ç§çº¿æ¡å’Œæ ‡è®°çš„å«ä¹‰

### æŠ€æœ¯å®ç°

#### 1. æ•°æ®æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ è·å–è‚¡ç¥¨æ•°æ® â†’ è®¡ç®—ä¸Šå‡é€šé“ â†’ ç»˜åˆ¶é€šé“çº¿ â†’ æ˜¾ç¤ºä¿¡æ¯é¢æ¿
```

#### 2. å…³é”®ä»£ç 

```python
# åœ¨ä¾§è¾¹æ æ·»åŠ é€‰é¡¹
show_ascending_channel = st.checkbox('æ˜¾ç¤ºä¸Šå‡é€šé“', value=False)

# è®¡ç®—ä¸Šå‡é€šé“
if show_ascending_channel:
    channel_info = CalIndicators.ascending_channel(df_for_calc)
    st.session_state.ascending_channel_info = channel_info

# ç»˜åˆ¶é€šé“çº¿
if show_ascending_channel and ascending_channel_info:
    # è·å–å…³é”®å‚æ•°
    mid_today = ascending_channel_info.get('mid_today')
    mid_tomorrow = ascending_channel_info.get('mid_tomorrow')
    upper_today = ascending_channel_info.get('upper_today')
    lower_today = ascending_channel_info.get('lower_today')
    
    # è®¡ç®—æ–œç‡ï¼ˆåŸºäºmid_todayå’Œmid_tomorrowï¼‰
    beta = (mid_tomorrow - mid_today) / 1  # 1å¤©çš„å·®å€¼
    
    # è®¡ç®—ä¸Šæ²¿å’Œä¸‹æ²¿çš„èµ·å§‹ç‚¹
    days_to_today = (latest_date - anchor_date).days
    upper_anchor = upper_today - beta * days_to_today
    lower_anchor = lower_today - beta * days_to_today
    
    # ç»˜åˆ¶ä¸­è½´çº¿ã€ä¸Šæ²¿çº¿ã€ä¸‹æ²¿çº¿å’Œé”šç‚¹
    # æ·»åŠ æ‚¬åœæ–‡æœ¬å’Œäº¤äº’åŠŸèƒ½
```

#### 3. ç»˜åˆ¶ç®—æ³•

**æ–œç‡è®¡ç®—ï¼š**
```python
beta = (mid_tomorrow - mid_today) / days_diff
```

**ç›¸å¯¹å¤©æ•°è®¡ç®—ï¼š**
```python
days_relative_to_today = [days - days_to_today for days in days_since_anchor]
# ç¡®ä¿ä»Šæ—¥å¯¹åº”çš„ç›¸å¯¹å¤©æ•°ä¸º0
if days_relative_to_today and days_relative_to_today[-1] != 0:
    today_index = len(days_relative_to_today) - 1
    days_relative_to_today = [i - today_index for i in range(len(days_relative_to_today))]
```

**ä¸­è½´çº¿è®¡ç®—ï¼š**
```python
mid_prices = [mid_today + beta * days_rel for days_rel in days_relative_to_today]
```

**ä¸Šæ²¿çº¿è®¡ç®—ï¼š**
```python
upper_prices = [upper_today + beta * days_rel for days_rel in days_relative_to_today]
```

**ä¸‹æ²¿çº¿è®¡ç®—ï¼š**
```python
lower_prices = [lower_today + beta * days_rel for days_rel in days_relative_to_today]
```

#### 4. é”™è¯¯å¤„ç†

- æ•°æ®ä¸è¶³æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- è®¡ç®—å¤±è´¥æ—¶æä¾›å‹å¥½çš„é”™è¯¯æç¤º
- æ¨¡å—ä¸å¯ç”¨æ—¶ç»™å‡ºå®‰è£…å»ºè®®

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ29æ—¥  
**ç‰ˆæœ¬**: v1.1  
**æ–°å¢åŠŸèƒ½**: å‰ç«¯é¡µé¢é›†æˆæ”¯æŒ 