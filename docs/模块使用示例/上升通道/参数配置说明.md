# 上升通道策略参数配置说明

## 概述

上升通道回测策略采用分层参数设计，将参数分为两类：
1. **基本策略参数**: 作为独立参数传递，包括最大持仓数量和最小通道评分
2. **通道计算参数**: 通过 `**params` 传递，支持灵活的部分参数配置

这种设计既保持了代码的清晰性，又提供了参数配置的灵活性。

## 参数结构

### 基本策略参数（独立参数）

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `max_positions` | int | 10 | 最大持仓数量 |
| `min_channel_score` | float | 60.0 | 最小通道评分 |

### 上升通道计算参数（**params）

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `k` | float | 2.0 | 通道斜率参数 |
| `L_max` | int | 120 | 最大通道长度 |
| `delta_cut` | int | 5 | 通道宽度参数 |
| `pivot_m` | int | 3 | 枢轴点参数 |
| `gain_trigger` | float | 0.30 | 收益触发阈值 |
| `beta_delta` | float | 0.15 | Beta变化阈值 |
| `break_days` | int | 3 | 突破确认天数 |
| `reanchor_fail_max` | int | 2 | 重新锚定最大失败次数 |
| `min_data_points` | int | 60 | 最小数据点数 |
| `R2_min` | float | 0.20 | 最小R²值 |
| `width_pct_min` | float | 0.04 | 最小通道宽度百分比 |
| `width_pct_max` | float | 0.15 | 最大通道宽度百分比 |

## 使用示例

### 1. 使用默认参数

```python
from backend.business.backtest.strategies.rising_channel import RisingChannelBacktestStrategy

# 使用所有默认参数
strategy = RisingChannelBacktestStrategy()
```

### 2. 只修改基本参数

```python
# 只修改最大持仓数量
strategy = RisingChannelBacktestStrategy(max_positions=8)

# 只修改最小通道评分
strategy = RisingChannelBacktestStrategy(min_channel_score=70.0)

# 同时修改两个基本参数
strategy = RisingChannelBacktestStrategy(
    max_positions=12,
    min_channel_score=65.0
)
```

### 3. 只修改通道参数

```python
# 只修改通道斜率参数
strategy = RisingChannelBacktestStrategy(k=1.8)

# 修改多个通道参数
strategy = RisingChannelBacktestStrategy(
    k=2.2,
    gain_trigger=0.25,
    beta_delta=0.12
)
```

### 4. 混合修改参数

```python
# 同时修改基本参数和通道参数
strategy = RisingChannelBacktestStrategy(
    max_positions=15,
    min_channel_score=75.0,
    k=1.5,
    L_max=90,
    gain_trigger=0.35
)
```

### 5. 完整参数配置

```python
# 配置所有参数
strategy = RisingChannelBacktestStrategy(
    max_positions=15,
    min_channel_score=75.0,
    k=1.5,
    L_max=90,
    delta_cut=3,
    pivot_m=5,
    gain_trigger=0.35,
    beta_delta=0.20,
    break_days=5,
    reanchor_fail_max=3,
    min_data_points=80,
    R2_min=0.25,
    width_pct_min=0.05,
    width_pct_max=0.20
)
```

### 6. 使用便捷函数

```python
from backend.business.backtest.strategies.rising_channel import create_rising_channel_backtest_strategy

# 便捷函数支持相同的参数结构
strategy = create_rising_channel_backtest_strategy(
    max_positions=10,
    min_channel_score=65.0,
    k=2.0,
    gain_trigger=0.28
)
```

## 参数调优建议

### 保守策略配置

```python
strategy = RisingChannelBacktestStrategy(
    max_positions=5,           # 减少持仓数量，降低风险
    min_channel_score=70.0,    # 提高评分要求
    k=1.5,                     # 降低斜率要求
    gain_trigger=0.20,         # 降低收益触发阈值
    beta_delta=0.10            # 降低Beta变化阈值
)
```

### 激进策略配置

```python
strategy = RisingChannelBacktestStrategy(
    max_positions=15,          # 增加持仓数量
    min_channel_score=50.0,    # 降低评分要求
    k=2.5,                     # 提高斜率要求
    gain_trigger=0.40,         # 提高收益触发阈值
    beta_delta=0.20            # 提高Beta变化阈值
)
```

### 平衡策略配置

```python
strategy = RisingChannelBacktestStrategy(
    max_positions=10,          # 中等持仓数量
    min_channel_score=60.0,    # 中等评分要求
    k=2.0,                     # 标准斜率要求
    gain_trigger=0.30,         # 标准收益触发阈值
    beta_delta=0.15            # 标准Beta变化阈值
)
```

## 设计优势

### 1. 参数分类清晰
- **基本参数**: 直接影响策略的核心行为（持仓数量、评分要求）
- **通道参数**: 影响技术分析的计算细节

### 2. 使用灵活
- 可以只修改基本参数，保持通道参数默认值
- 可以只修改通道参数，保持基本参数默认值
- 支持任意组合的参数修改

### 3. 代码可读性
- 基本参数在函数签名中明确显示
- 通道参数通过**params灵活传递
- 参数含义一目了然

### 4. 维护便利性
- 新增基本参数时，函数签名会明确显示
- 新增通道参数时，不影响现有代码
- 参数文档结构清晰

## 注意事项

1. **参数验证**: 传入的参数会自动进行类型检查，确保参数类型正确。

2. **默认值保持**: 未传入的参数将使用默认值，不会影响策略的其他功能。

3. **参数独立性**: 每个参数都是独立的，可以任意组合使用。

4. **向后兼容**: 新的参数传递方式完全向后兼容，不会影响现有代码。

5. **文档同步**: 所有参数都有详细的文档说明，便于理解和使用。

## 常见问题

### Q: 为什么将参数分为两类？
A: 基本参数直接影响策略的核心行为，需要明确显示；通道参数较多且经常调整，使用**params更灵活。

### Q: 如何知道哪些参数是必需的？
A: 所有参数都有默认值，因此没有必需的参数。您可以根据需要传入任意组合的参数。

### Q: 参数的单位是什么？
A: 大部分参数都是无量纲的，具体含义请参考参数说明表格。

### Q: 如何调试参数效果？
A: 建议使用不同的参数组合进行回测，比较策略表现来找到最优参数。

### Q: 参数之间有依赖关系吗？
A: 参数之间基本独立，但建议根据策略逻辑合理配置相关参数。 