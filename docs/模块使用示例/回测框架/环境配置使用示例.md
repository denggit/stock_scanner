# 回测环境配置使用示例

## 概述

上升通道回测系统支持多种运行环境，可以根据不同的使用场景选择合适的股票数量限制，平衡性能和准确性。

## 环境类型

### 1. 开发环境 (development)
**用途**：策略开发和调试
```python
# 股票数量限制：100只
# 特点：快速迭代，快速验证策略逻辑
# 适用场景：策略开发、逻辑验证、问题调试

# 使用方式
runner = RisingChannelBacktestRunner(environment="development")
# 或者设置环境变量
export BACKTEST_ENV=development
python backend/business/backtest/execution/rising_channel_backtest.py
```

### 2. 优化环境 (optimization)
**用途**：参数优化
```python
# 股票数量限制：50只
# 特点：进一步减少股票数量，提高优化速度
# 适用场景：参数优化、策略调优

# 使用方式
runner = RisingChannelBacktestRunner(environment="optimization")
# 或者设置环境变量
export BACKTEST_ENV=optimization
python backend/business/backtest/execution/rising_channel_backtest.py
```

### 3. 生产环境 (production)
**用途**：正式回测
```python
# 股票数量限制：无限制（使用全量股票）
# 特点：使用全量数据，获得最准确的结果
# 适用场景：正式回测、策略评估、报告生成

# 使用方式
runner = RisingChannelBacktestRunner(environment="production")
# 或者设置环境变量
export BACKTEST_ENV=production
python backend/business/backtest/execution/rising_channel_backtest.py
```

### 4. 完整回测环境 (full_backtest)
**用途**：完整功能测试
```python
# 股票数量限制：2000只
# 特点：使用大量股票但有限制，平衡性能和准确性
# 适用场景：完整功能测试、性能评估

# 使用方式
runner = RisingChannelBacktestRunner(environment="full_backtest")
# 或者设置环境变量
export BACKTEST_ENV=full_backtest
python backend/business/backtest/execution/rising_channel_backtest.py
```

## 使用示例

### 1. 开发阶段使用

```python
from backend.business.backtest_event.execution.rising_channel_backtest import RisingChannelBacktestRunner

# 开发环境 - 快速验证策略逻辑
def test_strategy_logic():
    runner = RisingChannelBacktestRunner(environment="development")
    results = runner.run_basic_backtest()
    
    print(f"开发环境配置: {runner.config['description']}")
    print(f"股票数量限制: {runner.config['max_stocks']}")
    print(f"回测结果: {results}")
    
    return results

# 运行开发测试
if __name__ == "__main__":
    test_strategy_logic()
```

### 2. 参数优化使用

```python
# 优化环境 - 快速参数优化
def optimize_parameters():
    runner = RisingChannelBacktestRunner(environment="optimization")
    optimization_results = runner.run_parameter_optimization()
    
    print(f"优化环境配置: {runner.config['description']}")
    print(f"股票数量限制: {runner.config['max_stocks']}")
    print(f"最优参数: {optimization_results['best_params']}")
    
    return optimization_results
```

### 3. 生产环境使用

```python
# 生产环境 - 正式回测
def production_backtest():
    runner = RisingChannelBacktestRunner(environment="production")
    
    # 运行完整回测
    basic_results = runner.run_basic_backtest()
    comparison_results = runner.run_comparison_backtest()
    
    print(f"生产环境配置: {runner.config['description']}")
    print(f"股票数量限制: {runner.config['max_stocks']}")
    print(f"基础回测结果: {basic_results}")
    print(f"对比回测结果: {comparison_results}")
    
    return basic_results, comparison_results
```

### 4. 环境变量控制

```bash
# 设置环境变量来控制运行环境
export BACKTEST_ENV=development
python backend/business/backtest_event/execution/rising_channel_backtest.py

export BACKTEST_ENV=production
python backend/business/backtest_event/execution/rising_channel_backtest.py

export BACKTEST_ENV=optimization
python backend/business/backtest_event/execution/rising_channel_backtest.py
```

## 性能对比

| 环境 | 股票数量 | 运行时间 | 内存使用 | 准确性 | 适用场景 |
|------|----------|----------|----------|--------|----------|
| development | 100只 | 快 | 低 | 中等 | 开发调试 |
| optimization | 50只 | 很快 | 很低 | 较低 | 参数优化 |
| production | 无限制 | 慢 | 高 | 高 | 正式回测 |
| full_backtest | 2000只 | 中等 | 中等 | 较高 | 完整测试 |

## 最佳实践

### 1. 开发流程
```python
# 1. 开发阶段：使用development环境
runner = RisingChannelBacktestRunner(environment="development")
results = runner.run_basic_backtest()

# 2. 参数优化：使用optimization环境
runner = RisingChannelBacktestRunner(environment="optimization")
optimization_results = runner.run_parameter_optimization()

# 3. 最终验证：使用production环境
runner = RisingChannelBacktestRunner(environment="production")
final_results = runner.run_basic_backtest()
```

### 2. 自动化脚本
```python
# 创建自动化测试脚本
def run_full_test_pipeline():
    """运行完整的测试流程"""
    
    # 开发环境测试
    print("=== 开发环境测试 ===")
    dev_runner = RisingChannelBacktestRunner(environment="development")
    dev_results = dev_runner.run_basic_backtest()
    
    # 优化环境测试
    print("=== 优化环境测试 ===")
    opt_runner = RisingChannelBacktestRunner(environment="optimization")
    opt_results = opt_runner.run_parameter_optimization()
    
    # 生产环境测试
    print("=== 生产环境测试 ===")
    prod_runner = RisingChannelBacktestRunner(environment="production")
    prod_results = prod_runner.run_basic_backtest()
    
    return {
        'development': dev_results,
        'optimization': opt_results,
        'production': prod_results
    }
```

### 3. 配置管理
```python
# 创建配置文件
config = {
    'development': {
        'max_stocks': 100,
        'description': '开发环境 - 快速验证策略逻辑'
    },
    'production': {
        'max_stocks': None,
        'description': '生产环境 - 全量股票回测'
    }
}

# 根据配置创建运行器
def create_runner(env_name: str):
    return RisingChannelBacktestRunner(environment=env_name)
```

## 总结

通过环境配置，我们可以在不同阶段使用合适的股票数量限制：

- **开发阶段**：限制100只股票，快速迭代
- **优化阶段**：限制50只股票，快速优化
- **生产阶段**：不限制股票数量，获得准确结果

这样既保证了开发效率，又确保了生产环境的准确性。 