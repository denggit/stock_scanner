# ğŸ“ ç›®å½•ç»“æ„è‡ªåŠ¨æ›´æ–°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è‡ªåŠ¨æ›´æ–°é¡¹ç›®çš„ç›®å½•ç»“æ„æ–‡æ¡£ï¼Œç¡®ä¿æ–‡æ¡£ä¸å®é™…ä»£ç ç»“æ„ä¿æŒåŒæ­¥ã€‚

## ğŸ”§ æ›´æ–°å·¥å…·

### 1. è‡ªåŠ¨æ›´æ–°è„šæœ¬

é¡¹ç›®æä¾›äº†è‡ªåŠ¨æ›´æ–°ç›®å½•ç»“æ„çš„è„šæœ¬ï¼š

```bash
# è¿è¡Œè‡ªåŠ¨æ›´æ–°è„šæœ¬
python scripts/update_directory_structure.py
```

### 2. æ‰‹åŠ¨æ›´æ–°

å¦‚æœè‡ªåŠ¨è„šæœ¬ä¸å¯ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ–°ï¼š

```bash
# ç”Ÿæˆç›®å½•æ ‘
tree -I 'venv|__pycache__|*.pyc|.git|.DS_Store' > temp_structure.txt

# æˆ–è€…ä½¿ç”¨findå‘½ä»¤
find . -type f -name "*.py" -o -name "*.md" -o -name "*.yaml" -o -name "*.json" | grep -v venv | grep -v __pycache__ > temp_structure.txt
```

## ğŸ“Š ç›®å½•ç»“æ„è§„èŒƒ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

- **Pythonæ–‡ä»¶**: ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œå¦‚ `data_fetcher.py`
- **é…ç½®æ–‡ä»¶**: ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œå¦‚ `channel_config.yaml`
- **æ–‡æ¡£æ–‡ä»¶**: ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œå¦‚ `ä¸Šå‡é€šé“å›å½’æ¨¡å—ä½¿ç”¨ç¤ºä¾‹.md`
- **ç›®å½•å**: ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œå¦‚ `channel_analysis`

### 2. ç›®å½•ç»„ç»‡è§„èŒƒ

```
backend/
â”œâ”€â”€ business/           # ä¸šåŠ¡å±‚ï¼ˆç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ backtest/      # å›æµ‹ä¸šåŠ¡
â”‚   â”œâ”€â”€ data/          # æ•°æ®ä¸šåŠ¡
â”‚   â”œâ”€â”€ factor/        # å› å­ä¸šåŠ¡
â”‚   â”œâ”€â”€ ml/            # æœºå™¨å­¦ä¹ ä¸šåŠ¡
â”‚   â””â”€â”€ strategies/    # ç­–ç•¥ä¸šåŠ¡
â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”œâ”€â”€ interface/         # æ¥å£å±‚
â””â”€â”€ utils/             # å·¥å…·å±‚
```

### 3. æ–‡æ¡£ç»„ç»‡è§„èŒƒ

```
docs/
â”œâ”€â”€ æ¨¡å—ä½¿ç”¨ç¤ºä¾‹/      # ä½¿ç”¨ç¤ºä¾‹æ–‡æ¡£
â”‚   â”œâ”€â”€ ä¸Šå‡é€šé“/     # ä¸Šå‡é€šé“ç›¸å…³ç¤ºä¾‹
â”‚   â””â”€â”€ å›æµ‹æ¡†æ¶/     # å›æµ‹æ¡†æ¶ç›¸å…³ç¤ºä¾‹
â”œâ”€â”€ æ¨¡å—å¼€å‘æ–‡æ¡£/      # å¼€å‘æ–‡æ¡£
â”‚   â”œâ”€â”€ ä¸Šå‡é€šé“/     # ä¸Šå‡é€šé“å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ å›æµ‹æ¡†æ¶/     # å›æµ‹æ¡†æ¶å¼€å‘æ–‡æ¡£
â””â”€â”€ é¡¹ç›®æ–‡æ¡£/         # é¡¹ç›®çº§æ–‡æ¡£
```

## ğŸ”„ æ›´æ–°æµç¨‹

### 1. æ£€æµ‹å˜æ›´

```python
import os
import hashlib
import json

def detect_changes():
    """æ£€æµ‹ç›®å½•ç»“æ„å˜æ›´"""
    
    # è®¡ç®—å½“å‰ç›®å½•ç»“æ„çš„å“ˆå¸Œå€¼
    current_hash = calculate_directory_hash()
    
    # è¯»å–ä¸Šæ¬¡çš„å“ˆå¸Œå€¼
    try:
        with open('.directory_hash', 'r') as f:
            last_hash = f.read().strip()
    except FileNotFoundError:
        last_hash = None
    
    # æ¯”è¾ƒå“ˆå¸Œå€¼
    if current_hash != last_hash:
        print("æ£€æµ‹åˆ°ç›®å½•ç»“æ„å˜æ›´ï¼Œéœ€è¦æ›´æ–°æ–‡æ¡£")
        return True
    else:
        print("ç›®å½•ç»“æ„æ— å˜æ›´")
        return False

def calculate_directory_hash():
    """è®¡ç®—ç›®å½•ç»“æ„çš„å“ˆå¸Œå€¼"""
    structure = []
    
    for root, dirs, files in os.walk('.'):
        # å¿½ç•¥ç‰¹å®šç›®å½•
        dirs[:] = [d for d in dirs if d not in ['venv', '__pycache__', '.git', '.DS_Store']]
        
        for file in files:
            if file.endswith(('.py', '.md', '.yaml', '.json')):
                rel_path = os.path.relpath(os.path.join(root, file), '.')
                structure.append(rel_path)
    
    # æ’åºç¡®ä¿ä¸€è‡´æ€§
    structure.sort()
    
    # è®¡ç®—å“ˆå¸Œå€¼
    content = '\n'.join(structure).encode('utf-8')
    return hashlib.md5(content).hexdigest()
```

### 2. ç”Ÿæˆç›®å½•æ ‘

```python
def generate_directory_tree():
    """ç”Ÿæˆç›®å½•æ ‘ç»“æ„"""
    
    tree_lines = []
    
    def add_to_tree(path, prefix="", is_last=True):
        """é€’å½’æ·»åŠ ç›®å½•åˆ°æ ‘ç»“æ„"""
        
        # è·å–ç›®å½•å†…å®¹
        try:
            items = os.listdir(path)
        except PermissionError:
            return
        
        # è¿‡æ»¤å’Œæ’åº
        items = [item for item in items if not item.startswith('.') and item not in ['venv', '__pycache__']]
        items.sort()
        
        # åˆ†ç¦»æ–‡ä»¶å’Œç›®å½•
        dirs = [item for item in items if os.path.isdir(os.path.join(path, item))]
        files = [item for item in items if os.path.isfile(os.path.join(path, item))]
        
        # æ·»åŠ ç›®å½•
        for i, dir_name in enumerate(dirs):
            is_last_dir = i == len(dirs) - 1 and len(files) == 0
            tree_lines.append(f"{prefix}{'â””â”€â”€ ' if is_last_dir else 'â”œâ”€â”€ '}ğŸ“ {dir_name}")
            
            new_prefix = prefix + ('    ' if is_last_dir else 'â”‚   ')
            add_to_tree(os.path.join(path, dir_name), new_prefix, is_last_dir)
        
        # æ·»åŠ æ–‡ä»¶
        for i, file_name in enumerate(files):
            is_last_file = i == len(files) - 1
            tree_lines.append(f"{prefix}{'â””â”€â”€ ' if is_last_file else 'â”œâ”€â”€ '}ğŸ“„ {file_name}")
    
    # ä»æ ¹ç›®å½•å¼€å§‹
    add_to_tree('.')
    
    return tree_lines
```

### 3. æ›´æ–°æ–‡æ¡£

```python
def update_documentation():
    """æ›´æ–°æ–‡æ¡£"""
    
    # ç”Ÿæˆæ–°çš„ç›®å½•æ ‘
    tree_lines = generate_directory_tree()
    
    # è¯»å–ç°æœ‰æ–‡æ¡£
    with open('docs/é¡¹ç›®ç›®å½•ç»“æ„.md', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # æ‰¾åˆ°ç›®å½•æ ‘éƒ¨åˆ†å¹¶æ›¿æ¢
    start_marker = "```\nâ””â”€â”€ ğŸ“ stock_scanner"
    end_marker = "```\n\n## ğŸ“‹ ç›®å½•ç»“æ„è¯´æ˜"
    
    start_pos = content.find(start_marker)
    end_pos = content.find(end_marker)
    
    if start_pos != -1 and end_pos != -1:
        # æ„å»ºæ–°çš„ç›®å½•æ ‘å†…å®¹
        new_tree_content = "```\nâ””â”€â”€ ğŸ“ stock_scanner\n"
        for line in tree_lines[1:]:  # è·³è¿‡æ ¹ç›®å½•è¡Œ
            new_tree_content += f"    {line}\n"
        new_tree_content += "```\n\n## ğŸ“‹ ç›®å½•ç»“æ„è¯´æ˜"
        
        # æ›¿æ¢å†…å®¹
        new_content = content[:start_pos] + new_tree_content + content[end_pos + len(end_marker):]
        
        # å†™å…¥æ–‡ä»¶
        with open('docs/é¡¹ç›®ç›®å½•ç»“æ„.md', 'w', encoding='utf-8') as f:
            f.write(new_content)
        
        print("æ–‡æ¡£æ›´æ–°å®Œæˆ")
    else:
        print("æœªæ‰¾åˆ°ç›®å½•æ ‘æ ‡è®°ï¼Œè¯·æ‰‹åŠ¨æ›´æ–°")
```

### 4. ä¿å­˜å“ˆå¸Œå€¼

```python
def save_directory_hash():
    """ä¿å­˜ç›®å½•ç»“æ„å“ˆå¸Œå€¼"""
    
    current_hash = calculate_directory_hash()
    
    with open('.directory_hash', 'w') as f:
        f.write(current_hash)
    
    print(f"ç›®å½•ç»“æ„å“ˆå¸Œå€¼å·²ä¿å­˜: {current_hash}")
```

## ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬

### å®Œæ•´çš„æ›´æ–°è„šæœ¬

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
@Author     : AI Assistant
@Date       : 2025-01-29
@File       : update_directory_structure.py
@Description: è‡ªåŠ¨æ›´æ–°é¡¹ç›®ç›®å½•ç»“æ„æ–‡æ¡£
"""

import os
import hashlib
import json
from datetime import datetime

def main():
    """ä¸»å‡½æ•°"""
    
    print("ğŸ”„ å¼€å§‹æ£€æŸ¥ç›®å½•ç»“æ„å˜æ›´...")
    
    # æ£€æµ‹å˜æ›´
    if detect_changes():
        print("ğŸ“ æ£€æµ‹åˆ°å˜æ›´ï¼Œå¼€å§‹æ›´æ–°æ–‡æ¡£...")
        
        # æ›´æ–°æ–‡æ¡£
        update_documentation()
        
        # ä¿å­˜å“ˆå¸Œå€¼
        save_directory_hash()
        
        print("âœ… ç›®å½•ç»“æ„æ–‡æ¡£æ›´æ–°å®Œæˆ")
    else:
        print("âœ… ç›®å½•ç»“æ„æ— å˜æ›´ï¼Œæ— éœ€æ›´æ–°")

if __name__ == "__main__":
    main()
```

## ğŸ“‹ æ‰‹åŠ¨æ›´æ–°æ£€æŸ¥æ¸…å•

å¦‚æœè‡ªåŠ¨æ›´æ–°ä¸å¯ç”¨ï¼Œè¯·æŒ‰ä»¥ä¸‹æ¸…å•æ‰‹åŠ¨æ›´æ–°ï¼š

### 1. æ£€æŸ¥æ–°å¢æ–‡ä»¶/ç›®å½•

- [ ] æ£€æŸ¥ `backend/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–°å¢çš„ä¸šåŠ¡æ¨¡å—
- [ ] æ£€æŸ¥ `pages/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–°å¢çš„å‰ç«¯é¡µé¢
- [ ] æ£€æŸ¥ `docs/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–°å¢çš„æ–‡æ¡£
- [ ] æ£€æŸ¥ `scripts/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ–°å¢çš„è„šæœ¬

### 2. æ£€æŸ¥åˆ é™¤çš„æ–‡ä»¶/ç›®å½•

- [ ] ç¡®è®¤å·²åˆ é™¤çš„æ–‡ä»¶/ç›®å½•å·²ä»æ–‡æ¡£ä¸­ç§»é™¤
- [ ] æ›´æ–°ç›¸å…³çš„å¼•ç”¨å’Œé“¾æ¥

### 3. æ£€æŸ¥é‡å‘½åçš„æ–‡ä»¶/ç›®å½•

- [ ] æ›´æ–°æ–‡æ¡£ä¸­çš„æ–‡ä»¶/ç›®å½•åç§°
- [ ] æ›´æ–°ç›¸å…³çš„å¼•ç”¨å’Œé“¾æ¥

### 4. æ›´æ–°æ–‡æ¡£å†…å®¹

- [ ] æ›´æ–° `docs/é¡¹ç›®ç›®å½•ç»“æ„.md` ä¸­çš„ç›®å½•æ ‘
- [ ] æ›´æ–° `docs/å¿«é€Ÿå‚è€ƒæ‰‹å†Œ.md` ä¸­çš„è·¯å¾„å¼•ç”¨
- [ ] æ›´æ–° `docs/APIæ¥å£æ–‡æ¡£.md` ä¸­çš„æ¨¡å—è·¯å¾„
- [ ] æ›´æ–° `docs/é¡¹ç›®å·¥å…·åŠŸèƒ½æ–‡æ¡£.md` ä¸­çš„æ–‡ä»¶è·¯å¾„

## ğŸ” éªŒè¯æ›´æ–°

### 1. æ£€æŸ¥æ–‡æ¡£ä¸€è‡´æ€§

```python
def verify_documentation_consistency():
    """éªŒè¯æ–‡æ¡£ä¸€è‡´æ€§"""
    
    # è¯»å–ç›®å½•ç»“æ„æ–‡æ¡£
    with open('docs/é¡¹ç›®ç›®å½•ç»“æ„.md', 'r', encoding='utf-8') as f:
        structure_content = f.read()
    
    # æ£€æŸ¥å…³é”®è·¯å¾„æ˜¯å¦å­˜åœ¨
    key_paths = [
        'backend/business/',
        'backend/services/',
        'backend/interface/',
        'backend/utils/',
        'pages/',
        'docs/',
        'scripts/'
    ]
    
    missing_paths = []
    for path in key_paths:
        if path not in structure_content:
            missing_paths.append(path)
    
    if missing_paths:
        print(f"âš ï¸ æ–‡æ¡£ä¸­ç¼ºå°‘ä»¥ä¸‹è·¯å¾„: {missing_paths}")
        return False
    else:
        print("âœ… æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡")
        return True
```

### 2. æ£€æŸ¥é“¾æ¥æœ‰æ•ˆæ€§

```python
def check_document_links():
    """æ£€æŸ¥æ–‡æ¡£ä¸­çš„é“¾æ¥æœ‰æ•ˆæ€§"""
    
    # è¯»å–æ‰€æœ‰æ–‡æ¡£
    doc_files = []
    for root, dirs, files in os.walk('docs'):
        for file in files:
            if file.endswith('.md'):
                doc_files.append(os.path.join(root, file))
    
    broken_links = []
    
    for doc_file in doc_files:
        with open(doc_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # æ£€æŸ¥æ–‡ä»¶å¼•ç”¨
        import re
        file_refs = re.findall(r'`([^`]+\.py)`', content)
        
        for ref in file_refs:
            if not os.path.exists(ref):
                broken_links.append((doc_file, ref))
    
    if broken_links:
        print("âš ï¸ å‘ç°æ— æ•ˆé“¾æ¥:")
        for doc_file, link in broken_links:
            print(f"  {doc_file}: {link}")
        return False
    else:
        print("âœ… æ‰€æœ‰é“¾æ¥æœ‰æ•ˆ")
        return True
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬å†å²

- **v2.0** (2025-01-29): é‡æ„ä¸ºä¸šåŠ¡å±‚æ¶æ„ï¼Œæ›´æ–°æ‰€æœ‰æ–‡æ¡£
- **v1.5** (2024-12-31): æ·»åŠ ä¸Šå‡é€šé“æ¨¡å—æ–‡æ¡£
- **v1.0** (2024-11-15): åˆå§‹ç‰ˆæœ¬

### æœ€è¿‘æ›´æ–°

- âœ… æ›´æ–°é¡¹ç›®ç›®å½•ç»“æ„ï¼Œåæ˜ ä¸šåŠ¡å±‚é‡æ„
- âœ… æ›´æ–°å¿«é€Ÿå‚è€ƒæ‰‹å†Œï¼Œæ·»åŠ æ–°çš„APIå’ŒåŠŸèƒ½
- âœ… æ›´æ–°APIæ¥å£æ–‡æ¡£ï¼Œæ”¹è¿›é”™è¯¯å¤„ç†
- âœ… æ›´æ–°é¡¹ç›®å·¥å…·åŠŸèƒ½æ–‡æ¡£ï¼Œå®Œå–„ä½¿ç”¨ç¤ºä¾‹
- âœ… æ›´æ–°æ¨¡å—ä½¿ç”¨ç¤ºä¾‹ï¼Œæ·»åŠ é«˜çº§åŠŸèƒ½
- âœ… æ›´æ–°å›æµ‹æ¡†æ¶æ–‡æ¡£ï¼Œæ·»åŠ è‡ªå®šä¹‰ç­–ç•¥ç¤ºä¾‹

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è‡ªåŠ¨æ›´æ–°è„šæœ¬å¤±è´¥**
   - æ£€æŸ¥Pythonç¯å¢ƒ
   - ç¡®è®¤æ–‡ä»¶æƒé™
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **æ–‡æ¡£æ ¼å¼é”™è¯¯**
   - æ£€æŸ¥Markdownè¯­æ³•
   - ç¡®è®¤ç¼–ç æ ¼å¼
   - éªŒè¯ç‰¹æ®Šå­—ç¬¦

3. **ç›®å½•ç»“æ„ä¸ä¸€è‡´**
   - æ‰‹åŠ¨æ£€æŸ¥æ–‡ä»¶è·¯å¾„
   - æ›´æ–°å“ˆå¸Œå€¼
   - é‡æ–°è¿è¡Œæ›´æ–°è„šæœ¬

### è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. ç¡®è®¤Pythonç‰ˆæœ¬
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025å¹´8æœˆ5æ—¥
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0 