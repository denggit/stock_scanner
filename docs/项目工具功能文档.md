# è‚¡ç¥¨ç­›é€‰ç³»ç»Ÿ - å·¥å…·åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [å·¥å…·ç±»](#å·¥å…·ç±»)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [ç¼“å­˜ç³»ç»Ÿ](#ç¼“å­˜ç³»ç»Ÿ)
- [æ€§èƒ½ç›‘æ§](#æ€§èƒ½ç›‘æ§)
- [æ•°æ®æº](#æ•°æ®æº)
- [ç­–ç•¥ç³»ç»Ÿ](#ç­–ç•¥ç³»ç»Ÿ)
- [å›æµ‹ç³»ç»Ÿ](#å›æµ‹ç³»ç»Ÿ)
- [å‰ç«¯ç•Œé¢](#å‰ç«¯ç•Œé¢)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

---

## ğŸ—ï¸ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é‡åŒ–äº¤æ˜“å¹³å°ï¼ŒåŒ…å«è‚¡ç¥¨æ•°æ®è·å–ã€ç­–ç•¥å¼€å‘ã€å›æµ‹åˆ†æã€å®æ—¶ç›‘æ§ç­‰åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ

- **åç«¯**: FastAPI + Python
- **å‰ç«¯**: Streamlit
- **æ•°æ®åº“**: MySQL + Redis
- **æ•°æ®æº**: Baostock + AKShare
- **æœºå™¨å­¦ä¹ **: scikit-learn + XGBoost

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### 1. æ•°æ®æºæ¨¡å— (`backend/data_source/`)

#### BaostockSource

```python
from backend.data.source.baostock_src import BaostockSource

# åˆå§‹åŒ–æ•°æ®æº
source = BaostockSource()

# è·å–è‚¡ç¥¨åˆ—è¡¨
stocks = source.get_stock_list()

# è·å–è‚¡ç¥¨æ•°æ®
data = source.get_stock_data(
  code="000001.SZ",
  start_date="2024-01-01",
  end_date="2024-12-31",
  frequency="daily"
)

# è·å–è´¢åŠ¡æ•°æ®
profit_data = source.get_profit_data(code="000001.SZ", year=2024)
balance_data = source.get_balance_data(code="000001.SZ", year=2024)
```

#### AKShareSource

```python
from backend.data.source.akshare_src import AKShareSource

# è·å–è´¢åŠ¡æ•°æ®
financial_data = AKShareSource.get_financial_data("000001", "income")

# è·å–æœºæ„å‚ä¸åº¦
institution_data = AKShareSource.get_institution_participation("000001")
```

### 2. ç­–ç•¥ç³»ç»Ÿ (`backend/strategies/`)

#### çˆ†å‘å¼é€‰è‚¡ç­–ç•¥

```python
from backend.strategies.explosive_stock import ExplosiveStockStrategy

# åˆå§‹åŒ–ç­–ç•¥
strategy = ExplosiveStockStrategy()

# è®¾ç½®å‚æ•°
strategy.set_parameters({
    "volume_ma": 20,
    "rsi_period": 14,
    "signal": 70.0,
    "volume_ratio": 1.5
})

# ç”Ÿæˆä¿¡å·
signal = strategy.generate_signal(stock_data)
print(f"ä¿¡å·å¼ºåº¦: {signal['signal']}")
print(f"ä¹°å…¥å»ºè®®: {signal['buy_signal']}")
```

#### å‡çº¿å›è¸©ç­–ç•¥

```python
from backend.strategies.ma_pullback import MAPullbackStrategy

strategy = MAPullbackStrategy()
strategy.set_parameters({
    "ma_period": 20,
    "lookback_period": 20,
    "price_margin": 0.01
})
```

#### æ³¢æ®µäº¤æ˜“ç­–ç•¥

```python
from backend.strategies.swing_trading import SwingTradingStrategy

strategy = SwingTradingStrategy()
strategy.set_parameters({
    "short_ma_period": 5,
    "long_ma_period": 20,
    "rsi_period": 14
})
```

---

## ğŸ› ï¸ å·¥å…·ç±»

### 1. ç¼“å­˜ç®¡ç†å™¨ (`backend/utils/cache_manager.py`)

#### åŸºæœ¬ä½¿ç”¨

```python
from backend.utils.cache_manager import get_cache_manager, cached

# è·å–ç¼“å­˜ç®¡ç†å™¨
cache = get_cache_manager()

# è®¾ç½®ç¼“å­˜
cache.set("stock_data_000001", data, expire=1800)  # 30åˆ†é’Ÿè¿‡æœŸ

# è·å–ç¼“å­˜
data = cache.get("stock_data_000001")

# åˆ é™¤ç¼“å­˜
cache.delete("stock_data_000001")

# æ¸…ç†æ‰€æœ‰ç¼“å­˜
cache.clear()
```

#### ç¼“å­˜è£…é¥°å™¨

```python
from backend.utils.cache_manager import stock_data_cache, strategy_result_cache

@stock_data_cache(expire=1800)
def get_stock_data(code: str, start_date: str, end_date: str):
    # è·å–è‚¡ç¥¨æ•°æ®çš„é€»è¾‘
    return data

@strategy_result_cache(expire=3600)
def run_strategy(strategy_name: str, params: dict):
    # è¿è¡Œç­–ç•¥çš„é€»è¾‘
    return results
```

### 2. æ€§èƒ½ç›‘æ§ (`backend/utils/performance_monitor.py`)

#### å¯åŠ¨ç›‘æ§

```python
from backend.utils.performance_monitor import get_performance_monitor, monitor_api

# è·å–ç›‘æ§å™¨
monitor = get_performance_monitor()

# å¯åŠ¨ç›‘æ§
monitor.start_monitoring()

# è·å–å½“å‰æŒ‡æ ‡
metrics = monitor.get_current_metrics()
health = monitor.get_current_health()

# è·å–ç»Ÿè®¡ä¿¡æ¯
stats = monitor.get_statistics()
```

#### æ€§èƒ½ç›‘æ§è£…é¥°å™¨

```python
from backend.utils.performance_monitor import monitor_api, monitor_database, monitor_strategy

@monitor_api
def api_endpoint():
    # APIé€»è¾‘
    pass

@monitor_database
def database_query():
    # æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
    pass

@monitor_strategy
def strategy_execution():
    # ç­–ç•¥æ‰§è¡Œé€»è¾‘
    pass
```

### 3. æŠ€æœ¯æŒ‡æ ‡è®¡ç®— (`backend/utils/indicators.py`)

```python
from backend.utils.indicators import CalIndicators

# è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
ma20 = CalIndicators.ema(df, 20, 'close')

# è®¡ç®—RSI
rsi = CalIndicators.rsi(df, 14)

# è®¡ç®—MACD
macd, signal, hist = CalIndicators.macd(df)

# è®¡ç®—å¸ƒæ—å¸¦
mid, upper, lower = CalIndicators.bollinger_bands(df, 20, 2.0)
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### åº”ç”¨é…ç½® (`backend/configs/app_config.py`)

```python
from backend.configs.app_config import get_config

# è·å–é…ç½®
config = get_config()

# æ•°æ®åº“é…ç½®
db_url = config.get_database_url()
db_config = config.database

# Redisé…ç½®
redis_url = config.get_redis_url()

# ç­–ç•¥é…ç½®
strategy_config = config.strategy
min_signal_score = strategy_config.min_signal_score

# ç¼“å­˜é…ç½®
cache_config = config.cache
stock_data_expire = cache_config.stock_data_expire

# ç¯å¢ƒåˆ¤æ–­
if config.is_production():
    # ç”Ÿäº§ç¯å¢ƒé€»è¾‘
    pass
elif config.is_development():
    # å¼€å‘ç¯å¢ƒé€»è¾‘
    pass
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# æ•°æ®åº“é…ç½®
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=stock_scanner

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# åç«¯é…ç½®
BACKEND_URL=localhost
BACKEND_PORT=8000

# ç¯å¢ƒé…ç½®
ENVIRONMENT=development
DEBUG=true
```

---

## ğŸ“Š æ•°æ®ç®¡ç†

### æ•°æ®åº“ç®¡ç†å™¨ (`backend/data/database.py`)

```python
from backend.data.data_manager import DatabaseManager

# åˆå§‹åŒ–æ•°æ®åº“ç®¡ç†å™¨
db = DatabaseManager()

# è·å–è‚¡ç¥¨æ•°æ®
data = db.get_stock_daily("000001.SZ", "2024-01-01", "2024-12-31")

# æ›´æ–°è‚¡ç¥¨æ•°æ®
db.update_stock_daily("000001.SZ", stock_df, adjust="3")

# è·å–è‚¡ç¥¨åˆ—è¡¨
stock_list = db.get_stock_list()

# ä¿å­˜è´¢åŠ¡æ•°æ®
db.save_financial_data(financial_df, "profit")
```

### æ•°æ®æ›´æ–°ç®¡ç†å™¨ (`backend/data/data_manager.py`)

```python
from backend.data.data_update import DataUpdateManager

# åˆå§‹åŒ–æ•°æ®æ›´æ–°ç®¡ç†å™¨
manager = DataUpdateManager()

# æ›´æ–°è‚¡ç¥¨åˆ—è¡¨
manager.update_stock_list()

# æ›´æ–°æ—¥çº¿æ•°æ®
manager.update_daily_data(start_date="2024-01-01", end_date="2024-12-31")

# æ›´æ–°è´¢åŠ¡æ•°æ®
manager.update_financial_data(year=2024)
```

---

## ğŸ¯ ç­–ç•¥å¼€å‘

### ç­–ç•¥åŸºç±» (`backend/strategies/base.py`)

```python
from backend.strategies.base import BaseStrategy

class MyStrategy(BaseStrategy):
    def __init__(self):
        super().__init__(name="æˆ‘çš„ç­–ç•¥", description="ç­–ç•¥æè¿°")
        self._init_params()
    
    def _init_params(self):
        self._params = {
            "param1": 10,
            "param2": 20
        }
    
    def generate_signal(self, data: pd.DataFrame) -> pd.Series:
        # å®ç°ç­–ç•¥é€»è¾‘
        # è¿”å›ä¿¡å·Series
        return signal
```

### ç­–ç•¥æœåŠ¡ (`backend/services/strategy_service.py`)

```python
from backend.services.strategy_service import StrategyService

# åˆå§‹åŒ–ç­–ç•¥æœåŠ¡
service = StrategyService()

# æ‰«æè‚¡ç¥¨
results = await service.scan_stocks("çˆ†å‘å¼é€‰è‚¡ç­–ç•¥", {
    "volume_ma": 20,
    "signal": 70.0
})

# è·å–ç­–ç•¥åˆ—è¡¨
strategies = await service.list_strategies()
```

---

## ğŸ“ˆ å›æµ‹ç³»ç»Ÿ

### å›æµ‹æœåŠ¡ (`backend/services/backtest_service.py`)

```python
from backend.services.backtest_service import BacktestService

# åˆå§‹åŒ–å›æµ‹æœåŠ¡
backtest = BacktestService()

# è¿è¡Œå›æµ‹
results = await backtest.run_backtest(
    strategy="çˆ†å‘å¼é€‰è‚¡ç­–ç•¥",
    start_date="2024-01-01",
    end_date="2024-12-31",
    backtest_init_params={
        "stock_pool": "éSTè‚¡ç¥¨",
        "initial_capital": 100000,
        "max_positions": 4,
        "allocation_strategy": "ä¿¡å·å¼ºåº¦åŠ æƒ"
    },
    params={
        "volume_ma": 20,
        "signal": 70.0
    }
)
```

### å›æµ‹ç»“æœåˆ†æ

```python
# è·å–å›æµ‹æŒ‡æ ‡
total_return = results['total_return']
max_drawdown = results['max_drawdown']
sharpe_ratio = results['sharpe_ratio']

# è·å–äº¤æ˜“è®°å½•
trades = results['trades']

# è·å–æŒä»“è®°å½•
positions = results['positions']
```

---

## ğŸŒ å‰ç«¯ç•Œé¢

### æ•°æ®æŸ¥çœ‹å™¨ (`pages/data_viewer.py`)

è®¿é—® `http://localhost:8501` è¿›å…¥æ•°æ®æŸ¥çœ‹å™¨ï¼š

- **è‚¡ç¥¨ä»£ç è¾“å…¥**: è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š000001.SZï¼‰
- **æ—¶é—´èŒƒå›´é€‰æ‹©**: é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ
- **æŠ€æœ¯æŒ‡æ ‡æ˜¾ç¤º**:
    - Kçº¿å›¾
    - ç§»åŠ¨å¹³å‡çº¿
    - MACDæŒ‡æ ‡
    - RSIæŒ‡æ ‡
    - å¸ƒæ—å¸¦
    - æˆäº¤é‡

### ç­–ç•¥æ‰«æå™¨ (`pages/strategy_scanner.py`)

è®¿é—®ç­–ç•¥æ‰«æå™¨é¡µé¢ï¼š

- **ç­–ç•¥é€‰æ‹©**: é€‰æ‹©è¦ä½¿ç”¨çš„ç­–ç•¥
- **å‚æ•°é…ç½®**: è®¾ç½®ç­–ç•¥å‚æ•°
- **è‚¡ç¥¨æ± é€‰æ‹©**: é€‰æ‹©æ‰«æçš„è‚¡ç¥¨èŒƒå›´
- **ç»“æœå±•ç¤º**: æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨åˆ—è¡¨

### å›æµ‹ç³»ç»Ÿ (`pages/backtest.py`)

è®¿é—®å›æµ‹ç³»ç»Ÿé¡µé¢ï¼š

- **å›æµ‹å‚æ•°è®¾ç½®**: è®¾ç½®å›æµ‹æ—¶é—´ã€èµ„é‡‘ç­‰
- **ç­–ç•¥å‚æ•°é…ç½®**: é…ç½®ç­–ç•¥å‚æ•°
- **ç»“æœåˆ†æ**: æŸ¥çœ‹å›æµ‹ç»“æœå’Œå›¾è¡¨

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®åº“é…ç½®

```bash
# å®‰è£…MySQL
# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE stock_scanner;

# å®‰è£…Redis
# å¯åŠ¨RedisæœåŠ¡
redis-server
```

### 3. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=stock_scanner

REDIS_HOST=localhost
REDIS_PORT=6379

BACKEND_URL=localhost
BACKEND_PORT=8000

ENVIRONMENT=development
DEBUG=true
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡
python run_backend.py

# å¯åŠ¨å‰ç«¯æœåŠ¡
python run_frontend.py
```

### 5. æ•°æ®åˆå§‹åŒ–

```python
from backend.data.data_update import DataUpdateManager

# åˆå§‹åŒ–æ•°æ®
manager = DataUpdateManager()
manager.update_stock_list()
manager.update_daily_data()
```

---

## ğŸ“ å¸¸ç”¨å·¥å…·å‡½æ•°

### 1. æ—¥å¿—å·¥å…· (`backend/utils/logger.py`)

```python
from backend.utils.logger import setup_logger

# è®¾ç½®æ—¥å¿—
logger = setup_logger("my_module")

# ä½¿ç”¨æ—¥å¿—
logger.info("ä¿¡æ¯æ—¥å¿—")
logger.warning("è­¦å‘Šæ—¥å¿—")
logger.error("é”™è¯¯æ—¥å¿—")
logger.debug("è°ƒè¯•æ—¥å¿—")
```

### 2. æ–‡ä»¶å·¥å…· (`backend/utils/file_check.py`)

```python
from backend.utils.file_check import ensure_dir

# ç¡®ä¿ç›®å½•å­˜åœ¨
ensure_dir("path/to/directory")
```

### 3. æ ¼å¼åŒ–å·¥å…· (`backend/utils/format_info.py`)

```python
from backend.utils import format_info

# æ ¼å¼åŒ–è‚¡ç¥¨ä»£ç 
formatted_code = format_info.stock_code("000001")
```

---

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### 1. æ€§èƒ½ç›‘æ§

```python
# æŸ¥çœ‹å½“å‰æ€§èƒ½æŒ‡æ ‡
monitor = get_performance_monitor()
metrics = monitor.get_current_metrics()
print(f"CPUä½¿ç”¨ç‡: {metrics.cpu_percent}%")
print(f"å†…å­˜ä½¿ç”¨ç‡: {metrics.memory_percent}%")

# æŸ¥çœ‹å¥åº·çŠ¶æ€
health = monitor.get_current_health()
print(f"ç³»ç»ŸçŠ¶æ€: {health.status}")
print(f"é—®é¢˜ä¿¡æ¯: {health.message}")
```

### 2. ç¼“å­˜ç›‘æ§

```python
# æŸ¥çœ‹ç¼“å­˜ä½¿ç”¨æƒ…å†µ
cache = get_cache_manager()
usage = cache.get_memory_usage()
print(f"å†…å­˜ç¼“å­˜å¤§å°: {usage['memory_cache_size']}")
print(f"Redisé”®æ•°é‡: {usage['redis_keys']}")

# æ¸…ç†è¿‡æœŸç¼“å­˜
cleaned = cache.cleanup_expired()
print(f"æ¸…ç†äº† {cleaned} ä¸ªè¿‡æœŸç¼“å­˜")
```

### 3. æ•°æ®åº“ç›‘æ§

```python
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
db = DatabaseManager()
try:
    db.conn.ping()
    print("æ•°æ®åº“è¿æ¥æ­£å¸¸")
except:
    print("æ•°æ®åº“è¿æ¥å¼‚å¸¸")
```

---

## ğŸ“š æœ€ä½³å®è·µ

### 1. ç­–ç•¥å¼€å‘

- ç»§æ‰¿ `BaseStrategy` ç±»
- å®ç° `generate_signal` æ–¹æ³•
- ä½¿ç”¨å‚æ•°åŒ–é…ç½®
- æ·»åŠ é€‚å½“çš„æ—¥å¿—è®°å½•

### 2. æ•°æ®å¤„ç†

- ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨æé«˜æ€§èƒ½
- å¤„ç†å¼‚å¸¸æƒ…å†µ
- éªŒè¯æ•°æ®å®Œæ•´æ€§

### 3. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ‰¹é‡å¤„ç†
- åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨

### 4. é”™è¯¯å¤„ç†

- ä½¿ç”¨å…·ä½“çš„å¼‚å¸¸ç±»å‹
- æ·»åŠ é‡è¯•æœºåˆ¶
- è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### 1. æ•°æ®æºè¿æ¥å¤±è´¥

```python
# æ£€æŸ¥ç½‘ç»œè¿æ¥
# æ£€æŸ¥APIå¯†é’¥
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```

### 2. æ•°æ®åº“è¿æ¥é—®é¢˜

```python
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
# éªŒè¯è¿æ¥å‚æ•°
# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
```

### 3. ç­–ç•¥æ‰§è¡Œç¼“æ…¢

```python
# ä½¿ç”¨ç¼“å­˜
# ä¼˜åŒ–ç®—æ³•
# å‡å°‘æ•°æ®é‡
```

### 4. å†…å­˜ä½¿ç”¨è¿‡é«˜

```python
# æ¸…ç†ç¼“å­˜
# ä¼˜åŒ–æ•°æ®ç»“æ„
# åˆ†æ‰¹å¤„ç†æ•°æ®
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ (`logs/app.log`)
2. æ£€æŸ¥ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
3. æŸ¥çœ‹é”™è¯¯å †æ ˆä¿¡æ¯
4. å‚è€ƒæœ¬æ–‡æ¡£

---

*æœ€åæ›´æ–°æ—¶é—´: 2025å¹´2æœˆ4æ—¥* 